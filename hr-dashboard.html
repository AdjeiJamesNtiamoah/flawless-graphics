<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>HR Dashboard — Professional Edition</title>

<!-- Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
/* ----------------- COLORS ----------------- */
:root {
  --primary:#0057b8;
  --primary-light:#3b82f6;
  --accent:#10b981;
  --danger:#ef4444;
  --bg:#f6f9fc;
  --sidebar-bg:#0c1427;
  --sidebar-hover:#162544;
  --text-dark:#1e293b;
  --text-muted:#6b7280;
  --card-bg:#ffffff;
  --radius:14px;
}

/* Dark Mode */
.dark {
  --bg:#0d1117;
  --card-bg:#161b22;
  --sidebar-bg:#0b0f14;
  --sidebar-hover:#1c2533;
  --text-dark:#e5e7eb;
  --text-muted:#94a3b8;
  --primary:#3b82f6;
}

/* ----------------- BASE ----------------- */
body {
  margin:0; background:var(--bg); font-family:Inter,Roboto,Arial; color:var(--text-dark);
  display:flex; height:100vh; overflow:hidden;
}

/* ----------------- SIDEBAR ----------------- */
.sidebar {
  width:250px; background:var(--sidebar-bg); color:white;
  display:flex; flex-direction:column; padding:20px 0;
  position:sticky; top:0; height:100vh;
  box-shadow:4px 0 18px rgba(0,0,0,.15);
}

.sidebar h2 {
  margin:0; text-align:center; font-size:20px; margin-bottom:25px;
  letter-spacing:1px; font-weight:700;
}

.nav-item {
  padding:14px 22px; cursor:pointer;
  display:flex; align-items:center; gap:12px; color:#cbd5e1;
  transition:.2s;
}

.nav-item:hover { background:var(--sidebar-hover); color:white; }

.nav-item i { width:22px; }

/* ---------------- CONTENT ---------------- */
.content {
  flex:1; overflow:auto; padding:25px;
}

/* ---------------- HEADER ---------------- */
.header {
  display:flex; justify-content:space-between; align-items:center;
  margin-bottom:22px;
}

.header .title { font-size:26px; font-weight:700; }

.header-right {
  display:flex; align-items:center; gap:12px;
}

.select {
  padding:8px 10px; border-radius:var(--radius); border:1px solid #d1d5db; background:white;
}

.btn {
  padding:8px 14px; border-radius:var(--radius); cursor:pointer;
  border:none; background:var(--primary); color:white; font-weight:600;
  transition:.2s;
}
.btn:hover { opacity:.85; }

.btn.light { background:#e5e7eb; color:#1e293b; }
.btn.danger { background:var(--danger); }

/* ---------------- CARDS ---------------- */
.grid { display:grid; gap:18px; }

.kpi {
  background:var(--card-bg); padding:20px; border-radius:var(--radius);
  display:flex; align-items:center; gap:18px;
  box-shadow:0 4px 14px rgba(0,0,0,.08);
}

.kpi i {
  font-size:28px; padding:18px; border-radius:50%;
  background:rgba(59,130,246,.12); color:var(--primary);
}

.kpi .value { font-size:26px; font-weight:700; }
.kpi .label { font-size:14px; color:var(--text-muted); }

/* ------------ SECTION CARD ------------- */
.card {
  background:var(--card-bg); padding:22px; border-radius:var(--radius);
  box-shadow:0 6px 18px rgba(0,0,0,.06);
}

.card-title { font-size:20px; font-weight:700; margin-bottom:10px; }

/* Tables */
table { width:100%; border-collapse:collapse; }
th,td { padding:10px; text-align:left; border-bottom:1px solid #e5e7eb; font-size:14px; }

/* Toast */
#toast {
  position:fixed; right:30px; bottom:30px; padding:14px 18px;
  background:#1e293b; color:white; border-radius:var(--radius);
  opacity:0; transform:translateY(20px); transition:.3s;
}
#toast.show { opacity:1; transform:none; }

/* Scrollbar */
::-webkit-scrollbar { width:8px; }
::-webkit-scrollbar-thumb { background:#cbd5e1; border-radius:8px; }

</style>
</head>

<body>

<!-- ------------------ SIDEBAR ------------------ -->
<div class="sidebar">
  <h2>HR PANEL</h2>

  <div class="nav-item"><i class="fa fa-home"></i> Dashboard</div>
  <div class="nav-item"><i class="fa fa-users"></i> Employees</div>
  <div class="nav-item"><i class="fa fa-calendar-check"></i> Attendance</div>
  <div class="nav-item"><i class="fa fa-sack-dollar"></i> Payroll</div>
  <div class="nav-item"><i class="fa fa-chart-pie"></i> Analytics</div>
  <div class="nav-item"><i class="fa fa-bullhorn"></i> Announcements</div>
  <div class="nav-item"><i class="fa fa-envelope"></i> Messages</div>
  <div class="nav-item"><i class="fa fa-cog"></i> Settings</div>
</div>

<!-- ------------------ MAIN CONTENT ------------------ -->
<div class="content">

<div class="header">
  <div class="title">HR Dashboard — <span id="orgNameDisplay">FLAWLESS</span></div>

  <div class="header-right">
    <select id="orgSwitcher" class="select"></select>
    <button class="btn light" id="toggleTheme"><i class="fa fa-moon"></i></button>
    <button class="btn" id="exportPDF">Export PDF</button>
    <button class="btn danger" id="clearData">Reset</button>
  </div>
</div>
<!-- ==================== DASHBOARD KPI CARDS ==================== -->
<div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); margin-bottom:22px;">

  <div class="kpi">
    <i class="fa fa-users"></i>
    <div>
      <div class="value" id="totalEmployees">0</div>
      <div class="label">Total Employees</div>
    </div>
  </div>

  <div class="kpi">
    <i class="fa fa-user-check"></i>
    <div>
      <div class="value" id="presentToday">0</div>
      <div class="label">Present Today</div>
    </div>
  </div>

  <div class="kpi">
    <i class="fa fa-user-xmark"></i>
    <div>
      <div class="value" id="absentToday">0</div>
      <div class="label">Absent Today</div>
    </div>
  </div>

  <div class="kpi">
    <i class="fa fa-sack-dollar"></i>
    <div>
      <div class="value" id="payrollTotal">₵0</div>
      <div class="label">Monthly Payroll</div>
    </div>
  </div>

</div>


<!-- ===================== EMPLOYEE LIST ===================== -->
<div class="card" style="margin-bottom:22px;">
  <div class="card-title">Employees</div>
  <button class="btn" id="addEmployeeBtn"><i class="fa fa-plus"></i> Add Employee</button>
  <br><br>

  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Role</th>
        <th>Email</th>
        <th>Salary</th>
        <th>Attendance</th>
      </tr>
    </thead>
    <tbody id="employeeTable"></tbody>
  </table>
</div>


<!-- ===================== ATTENDANCE OVERVIEW ===================== -->
<div class="card" style="margin-bottom:22px;">
  <div class="card-title">Attendance Overview</div>
  <canvas id="attendanceChart" height="120"></canvas>
</div>


<!-- ===================== ANNOUNCEMENTS ===================== -->
<div class="card" style="margin-bottom:22px;">
  <div class="card-title">Announcements</div>

  <div style="display:flex; gap:10px;">
    <input id="announcementInput" placeholder="Write announcement..." style="
      flex:1; padding:10px; border-radius:var(--radius); border:1px solid #d1d5db;">
    <button class="btn" id="postAnnouncement">Post</button>
  </div>

  <ul id="announcementList" style="margin-top:15px; padding-left:20px;"></ul>
</div>


<!-- ===================== PAYROLL SUMMARY ===================== -->
<div class="card" style="margin-bottom:22px;">
  <div class="card-title">Payroll Summary</div>
  <canvas id="payrollChart" height="120"></canvas>
</div>


<!-- ===================== ACTIVITY LOG ===================== -->
<div class="card" style="margin-bottom:22px;">
  <div class="card-title">Activity Log</div>
  <ul id="activityLog" style="padding-left:20px;"></ul>
</div>


<!-- ===================== TOAST MESSAGE ===================== -->
<div id="toast"></div>

</div> <!-- END CONTENT -->
</body>

<!-- ===================== JAVASCRIPT (CONTINUES IN PART 3) ===================== -->
<script>
console.log("HR Dashboard Loaded — Ready for JS Logic…");
/* ---------------------------
   PART 3 — HR DASHBOARD JS
   --------------------------- */

/* --- Utility helpers --- */
function safeParse(s){ try{return JSON.parse(s);}catch(e){return null;} }
function read(key){ return safeParse(localStorage.getItem(key)) || []; }
function save(key,val){ localStorage.setItem(key, JSON.stringify(val)); }
function now(){ return Date.now(); }

function showToast(msg, ms=2500){
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.classList.add('show');
  setTimeout(()=> el.classList.remove('show'), ms);
}

/* --- Organization / Keys --- */
const ACTIVE_ORG = (localStorage.getItem('active_org') || 'FLAWLESS').trim();
const ORG_LIST_KEY = 'organizations_list'; // optional list of orgs
const EMP_KEY = `${ACTIVE_ORG}_employees`;
const ATT_KEY = `${ACTIVE_ORG}_attendance`;
const PAY_KEY = `${ACTIVE_ORG}_payments`;
const ANN_KEY = `${ACTIVE_ORG}_announcements`;
const ACT_KEY = `${ACTIVE_ORG}_activity`;

/* Populate org display & switcher */
document.getElementById('orgNameDisplay').textContent = ACTIVE_ORG;
const orgSwitcher = document.getElementById('orgSwitcher');
(function populateOrgs(){
  let orgs = read(ORG_LIST_KEY);
  if(!orgs.length){
    orgs = [ACTIVE_ORG];
    save(ORG_LIST_KEY, orgs);
  }
  orgSwitcher.innerHTML = '';
  orgs.forEach(o => {
    const opt = document.createElement('option'); opt.value = o; opt.textContent = o;
    if(o === ACTIVE_ORG) opt.selected = true;
    orgSwitcher.appendChild(opt);
  });
})();
orgSwitcher.addEventListener('change', (e)=>{
  const val = e.target.value;
  localStorage.setItem('active_org', val);
  showToast(`Switched to ${val}`);
  setTimeout(()=> location.reload(), 600);
});

/* --- Data initializers --- */
if(!localStorage.getItem(EMP_KEY)) save(EMP_KEY, []);
if(!localStorage.getItem(ATT_KEY)) save(ATT_KEY, []);
if(!localStorage.getItem(PAY_KEY)) save(PAY_KEY, []);
if(!localStorage.getItem(ANN_KEY)) save(ANN_KEY, []);
if(!localStorage.getItem(ACT_KEY)) save(ACT_KEY, []);

/* --- Activity log helper --- */
function pushActivity(text){
  const arr = read(ACT_KEY);
  arr.push({ text, time: new Date().toISOString() });
  save(ACT_KEY, arr);
  renderActivity();
}

/* --- Employees render / CRUD --- */
const employeeTableEl = document.getElementById('employeeTable');

function renderEmployees(){
  const employees = read(EMP_KEY);
  employeeTableEl.innerHTML = '';
  employees.forEach((emp, idx) => {
    // compute today's attendance for quick badge
    const todays = read(ATT_KEY).filter(a => a.employeeId === emp.id && a.date.startsWith(new Date().toISOString().split('T')[0]));
    const last = todays[todays.length-1];
    const attText = last ? (last.action === 'in' ? 'IN' : 'OUT') : '—';
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${emp.name || emp.fullName || 'No name'}</td>
      <td>${emp.role || emp.department || 'Staff'}</td>
      <td>${emp.email || '-'}</td>
      <td>₵ ${Number(emp.salary||0).toLocaleString()}</td>
      <td>${attText}</td>
    `;
    // click to edit (simple inline)
    tr.addEventListener('dblclick', ()=> editEmployeePrompt(idx));
    employeeTableEl.appendChild(tr);
  });
}

/* Add employee via prompt (keeps the markup minimal) */
document.getElementById('addEmployeeBtn').addEventListener('click', ()=>{
  const name = prompt('Full name');
  if(!name) return showToast('Cancelled');
  const role = prompt('Role / Department','Staff') || 'Staff';
  const email = prompt('Email','') || '';
  const salaryStr = prompt('Salary (monthly)','0') || '0';
  const salary = Number(salaryStr) || 0;
  const id = 'e_' + Date.now();
  const employees = read(EMP_KEY);
  employees.push({ id, name, role, email, salary });
  save(EMP_KEY, employees);
  pushActivity(`Added employee ${name}`);
  renderEmployees(); updateKPIs(); updateCharts();
  showToast('Employee added');
});

/* Edit employee */
function editEmployeePrompt(index){
  const employees = read(EMP_KEY);
  const emp = employees[index];
  if(!emp) return;
  const name = prompt('Full name', emp.name || emp.fullName) || emp.name;
  const role = prompt('Role / Department', emp.role || emp.department) || emp.role;
  const email = prompt('Email', emp.email || '') || emp.email;
  const salary = Number(prompt('Salary', emp.salary || 0) || emp.salary);
  employees[index] = {...emp, name, role, email, salary};
  save(EMP_KEY, employees);
  pushActivity(`Updated employee ${name}`);
  renderEmployees(); updateKPIs(); updateCharts();
  showToast('Employee updated');
}

/* Delete employee helper (not exposed in table to keep UI clean) */
function deleteEmployeeById(id){
  let arr = read(EMP_KEY);
  const found = arr.find(a=>a.id===id);
  if(!found) return;
  if(!confirm(`Delete ${found.name || found.fullName}?`)) return;
  arr = arr.filter(a=>a.id!==id);
  save(EMP_KEY, arr);
  pushActivity(`Deleted employee ${found.name || found.fullName}`);
  renderEmployees(); updateKPIs(); updateCharts();
  showToast('Deleted');
}

/* --- Attendance helpers --- */
/* Attendance data shape: { employeeId, action: 'in'|'out', date: ISO } */

function recordAttendance(employeeId, action){
  const arr = read(ATT_KEY);
  arr.push({ employeeId, action, date: new Date().toISOString() });
  save(ATT_KEY, arr);
  pushActivity(`Attendance ${action.toUpperCase()} - ${employeeId}`);
  updateKPIs(); updateCharts(); renderEmployees();
}

/* Provide a quick UI accessible from console: HR can call recordAttendance(id,'in') */

/* --- KPIs --- */
function updateKPIs(){
  const employees = read(EMP_KEY);
  const attendance = read(ATT_KEY);
  const payments = read(PAY_KEY);

  document.getElementById('totalEmployees').textContent = employees.length;

  // Present / Absent today
  const today = new Date().toISOString().split('T')[0];
  const actionsToday = attendance.filter(a => a.date.startsWith(today));
  const presentSet = new Set(actionsToday.filter(a=>a.action==='in').map(a=>a.employeeId));
  const absentSet = new Set(actionsToday.filter(a=>a.action==='out').map(a=>a.employeeId)); // rough

  document.getElementById('presentToday').textContent = presentSet.size;
  // Absent = total - present (approx)
  const absentCount = Math.max(0, employees.length - presentSet.size);
  document.getElementById('absentToday').textContent = absentCount;

  // payroll total monthly (sum salaries)
  const totalPayroll = employees.reduce((s,e)=> s + Number(e.salary || 0), 0);
  document.getElementById('payrollTotal').textContent = '₵' + totalPayroll.toLocaleString();
}

/* --- Charts --- */
let attendanceChart = null;
let payrollChart = null;

function updateCharts(){
  // Attendance chart - last 7 days present count
  const attendance = read(ATT_KEY);
  const days = [];
  for(let i=6;i>=0;i--){
    const d = new Date(); d.setDate(d.getDate() - i);
    days.push(d.toISOString().split('T')[0]);
  }
  const presentCounts = days.map(day => {
    const set = new Set(attendance.filter(a=>a.date.startsWith(day) && a.action==='in').map(a=>a.employeeId));
    return set.size;
  });

  const ac = document.getElementById('attendanceChart').getContext('2d');
  if(attendanceChart) attendanceChart.destroy();
  attendanceChart = new Chart(ac, {
    type: 'bar',
    data: { labels: days.map(d=>d.slice(5)), datasets: [{ label:'Present', data: presentCounts, backgroundColor: '#3b82f6' }] },
    options: { plugins:{ legend:{ display:false }}, scales:{ y:{ beginAtZero:true } } }
  });

  // Payroll chart - last 6 months total payroll (static from salaries)
  const months = [];
  const monthLabels = [];
  const nowDate = new Date();
  for(let m=5;m>=0; m--){
    const dt = new Date(nowDate.getFullYear(), nowDate.getMonth()-m, 1);
    const key = dt.getFullYear() + '-' + String(dt.getMonth()+1).padStart(2,'0');
    months.push(key);
    monthLabels.push(dt.toLocaleString('default',{month:'short'}));
  }
  const employees = read(EMP_KEY);
  const payrollValues = months.map(()=> employees.reduce((s,e)=> s + Number(e.salary||0), 0));

  const pc = document.getElementById('payrollChart').getContext('2d');
  if(payrollChart) payrollChart.destroy();
  payrollChart = new Chart(pc, {
    type: 'line',
    data: { labels: monthLabels, datasets: [{ label:'Payroll (₵)', data: payrollValues, borderColor:'#10b981', backgroundColor:'rgba(16,185,129,0.12)', fill:true }] },
    options: { plugins:{ legend:{ display:false } }, scales:{ y:{ beginAtZero:true } } }
  });
}

/* --- Announcements --- */
function renderAnnouncements(){
  const list = read(ANN_KEY);
  const ul = document.getElementById('announcementList');
  ul.innerHTML = '';
  list.slice().reverse().forEach(a=>{
    const li = document.createElement('li');
    li.innerHTML = `<strong>${a.title||'Announcement'}</strong> — <span style="color:var(--text-muted)">${new Date(a.time).toLocaleString()}</span><div>${a.body||''}</div>`;
    ul.appendChild(li);
  });
}

document.getElementById('postAnnouncement').addEventListener('click', ()=>{
  const text = document.getElementById('announcementInput').value.trim();
  if(!text) return showToast('Enter an announcement');
  const list = read(ANN_KEY);
  list.push({ title: text.split('\n')[0], body: text, time: new Date().toISOString() });
  save(ANN_KEY, list);
  document.getElementById('announcementInput').value = '';
  pushActivity('Posted announcement');
  renderAnnouncements();
  showToast('Announcement posted');
});

/* --- Activity log render --- */
function renderActivity(){
  const arr = read(ACT_KEY).slice().reverse();
  const el = document.getElementById('activityLog');
  el.innerHTML = '';
  arr.slice(0,50).forEach(a=>{
    const li = document.createElement('li');
    li.innerHTML = `${a.text} — <span style="color:var(--text-muted)">${new Date(a.time).toLocaleString()}</span>`;
    el.appendChild(li);
  });
}

/* --- Export PDF --- */
document.getElementById('exportPDF').addEventListener('click', ()=>{
  const doc = new jsPDF('p','pt','a4');
  doc.setFontSize(16);
  doc.text(`${ACTIVE_ORG} — HR Report`, 40, 40);
  doc.setFontSize(11);
  doc.text(`Total employees: ${read(EMP_KEY).length}`, 40, 70);
  doc.text(`Present today: ${document.getElementById('presentToday').textContent}`, 40, 86);
  doc.text(`Payroll total: ${document.getElementById('payrollTotal').textContent}`, 40, 102);

  // List first 20 employees
  const emps = read(EMP_KEY).slice(0,20);
  let y = 140;
  emps.forEach((e,i)=>{
    doc.text(`${i+1}. ${e.name} — ${e.role} — ${e.email} — ₵ ${Number(e.salary||0).toLocaleString()}`, 40, y);
    y += 14;
    if(y > 740){ doc.addPage(); y = 40; }
  });

  doc.save(`${ACTIVE_ORG}_hr_report.pdf`);
});

/* --- Reset / Clear data --- */
document.getElementById('clearData').addEventListener('click', ()=>{
  if(!confirm('Reset all HR data for this organization? This cannot be undone.')) return;
  localStorage.removeItem(EMP_KEY);
  localStorage.removeItem(ATT_KEY);
  localStorage.removeItem(PAY_KEY);
  localStorage.removeItem(ANN_KEY);
  localStorage.removeItem(ACT_KEY);
  // recreate empty arrays to avoid errors
  save(EMP_KEY, []); save(ATT_KEY, []); save(PAY_KEY, []); save(ANN_KEY, []); save(ACT_KEY, []);
  renderAll();
  showToast('Reset complete');
});

/* --- Dark theme toggle --- */
document.getElementById('toggleTheme').addEventListener('click', ()=>{
  document.documentElement.classList.toggle('dark');
  const isDark = document.documentElement.classList.contains('dark');
  localStorage.setItem('hr_theme_dark', isDark ? '1' : '0');
});

/* Apply saved theme */
if(localStorage.getItem('hr_theme_dark') === '1') document.documentElement.classList.add('dark');

/* --- Teacher sync hint --- */
/* 
  Teacher attendance UI (teacher-profile) records teacher attendance under keys like:
  `${ORG}_teacher_attendance` or `${ORG}_attendance`. To keep HR dashboard in sync,
  you can push teacher attendance into this org attendance key from teacher pages:

  Example (run in teacher page):
   const arr = read(`${ACTIVE_ORG}_attendance`);
   arr.push({ employeeId: 'e_12345', action:'in', date: new Date().toISOString() });
   save(`${ACTIVE_ORG}_attendance`, arr);
   // the HR dashboard listens to 'storage' and will update when opened in another tab
*/

/* --- Storage event: update across tabs --- */
window.addEventListener('storage', (e)=>{
  const keys = [EMP_KEY, ATT_KEY, PAY_KEY, ANN_KEY, ACT_KEY];
  if(keys.includes(e.key)){
    renderAll();
  }
});

/* --- Render everything --- */
function renderAll(){
  renderEmployees();
  updateKPIs();
  updateCharts();
  renderAnnouncements();
  renderActivity();
}
renderAll();

/* --- Initial demo data (only if empty) --- */
(function seedDemo(){
  const emps = read(EMP_KEY);
  if(emps.length === 0){
    const demo = [
      { id:'e_1', name:'Adjei James', role:'Manager', email:'james@example.com', salary:3500 },
      { id:'e_2', name:'Emmanuel Ofori', role:'Data Analyst', email:'emmanuel@example.com', salary:2500 },
      { id:'e_3', name:'Ama Serwaa', role:'HR', email:'ama@example.com', salary:2200 }
    ];
    save(EMP_KEY, demo);
    pushActivity('Seeded demo employees');
    renderAll();
  }
})();

/* Final ready message */
console.log('HR Dashboard JS ready — All features wired.');
</script>
</html>
