<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>HR Dashboard | Flawless Graphics</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Icons + Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    body {
        margin: 0;
        font-family: Poppins, sans-serif;
        background: #f5f7fa;
        display: flex;
    }

    /* SIDEBAR */
    .sidebar {
        width: 240px;
        background: #001f3f;
        color: white;
        height: 100vh;
        padding-top: 30px;
        position: fixed;
        left: 0;
        top: 0;
    }
    .sidebar h2 {
        text-align: center;
        margin-bottom: 20px;
        font-weight: 600;
    }
    .nav-item {
        padding: 15px 20px;
        cursor: pointer;
        font-size: 16px;
        border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    .nav-item:hover {
        background: #003366;
    }

    /* MAIN PANEL */
    .content {
        margin-left: 260px;
        padding: 25px;
        width: calc(100% - 260px);
    }

    .section {
        display: none;
    }

    .kpi-box {
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        margin-bottom: 25px;
    }

    .grid-4 { 
        display: grid;
        grid-template-columns: repeat(4,1fr);
        gap: 20px;
    }

    .btn {
        padding: 12px 18px;
        background: #001f3f;
        color: white;
        border-radius: 6px;
        cursor: pointer;
        border: none;
        font-size: 14px;
    }
    .btn:hover { background: #003366; }

    table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        border-radius: 8px;
        overflow: hidden;
    }
    th, td {
        padding: 12px;
        border-bottom: 1px solid #eee;
        font-size: 14px;
    }
    th {
        background: #003366;
        color: white;
    }

    #toast {
        position: fixed;
        bottom: 30px;
        right: 30px;
        background: #333;
        padding: 15px 20px;
        border-radius: 6px;
        color: white;
        opacity: 0;
        transition: .5s;
    }
    #toast.show { opacity: 1; }

</style>
</head>
<body>

<!-- =============================================== -->
<!-- SIDEBAR -->
<!-- =============================================== -->
<div class="sidebar">
    <h2>HR PANEL</h2>
    <div class="nav-item">Dashboard</div>
    <div class="nav-item">Employee Management</div>
    <div class="nav-item">Attendance</div>
    <div class="nav-item">Payroll</div>
    <div class="nav-item">Announcements</div>
    <div class="nav-item">Analytics</div>
    <div class="nav-item">Messages</div>
    <div class="nav-item">Settings</div>
</div>

<!-- =============================================== -->
<!-- CONTENT AREA -->
<!-- =============================================== -->
<div class="content">

    <!-- DASHBOARD -->
    <div id="mainDashboard" class="section">
        <h1>HR Dashboard</h1>
        <div class="grid-4">
            <div class="kpi-box">
                <h3>Total Staff</h3>
                <p id="totalEmployees" style="font-size:28px;font-weight:700;">0</p>
            </div>
            <div class="kpi-box">
                <h3>Present Today</h3>
                <p id="presentToday" style="font-size:28px;font-weight:700;">0</p>
            </div>
            <div class="kpi-box">
                <h3>Absent Today</h3>
                <p id="absentToday" style="font-size:28px;font-weight:700;">0</p>
            </div>
            <div class="kpi-box">
                <h3>Total Monthly Payroll</h3>
                <p id="payrollTotal" style="font-size:28px;font-weight:700;">₵0</p>
            </div>
        </div>

        <div style="background:white;padding:20px;border-radius:8px;margin-bottom:30px;">
            <canvas id="attendanceChart"></canvas>
        </div>
        <div style="background:white;padding:20px;border-radius:8px;">
            <canvas id="payrollChart"></canvas>
        </div>
    </div>

    <!-- EMPLOYEE MANAGEMENT -->
    <div id="employeeSection" class="section">
        <h2>Employee Management</h2>
        <button class="btn" id="addEmployeeBtn">Add Employee</button>

        <table style="margin-top:20px;">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Role</th>
                    <th>Email</th>
                    <th>Salary</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="employeeTable"></tbody>
        </table>
    </div>

    <!-- ATTENDANCE -->
    <div id="attendanceSection" class="section">
        <h2>Attendance Records</h2>
        <table>
            <thead>
                <tr><th>Name</th><th>Date</th><th>Action</th></tr>
            </thead>
            <tbody id="attendanceTable"></tbody>
        </table>
    </div>

    <!-- PAYROLL -->
    <div id="payrollSection" class="section">
        <h2>Payroll Processing</h2>

        <button class="btn" id="generatePayrollBtn">Generate Payroll → Send to Finance</button>

        <table style="margin-top:20px;">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Salary</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="payrollList"></tbody>
        </table>
    </div>

    <!-- ANNOUNCEMENTS -->
    <div id="announcementSection" class="section">
        <h2>Announcements</h2>
        <textarea id="announcementInput" placeholder="Write announcement…" style="width:100%;height:80px;"></textarea>
        <br><br>
        <button class="btn" id="postAnnouncement">Post Announcement</button>

        <ul id="announcementList"></ul>
    </div>

    <!-- ANALYTICS -->
    <div id="analyticsSection" class="section">
        <h2>Analytics</h2>
        <p>Graphs and weekly data auto-updating...</p>
    </div>

    <!-- MESSAGES -->
    <div id="messageSection" class="section">
        <h2>Messages</h2>
        <p>Teacher → HR → Finance notifications synced.</p>
    </div>

    <!-- SETTINGS -->
    <div id="settingsSection" class="section">
        <h2>Settings</h2>
        <button class="btn" id="clearData">RESET DATABASE</button>
    </div>

</div>

<div id="toast"></div>

<!-- ============================================================ -->
<!-- START OF MASTER SCRIPT (MERGED + WORKFLOW ADDED) -->
<!-- ============================================================ -->
<script>
/* (HERE IS THE SAME SCRIPT YOU APPROVED BEFORE)  
   — Now extended with HR → FINANCE → TEACHER salary workflow 
   — Also includes dynamic payroll syncing
*/

function safeParse(s){try{return JSON.parse(s);}catch(e){return null;}}
function read(k){return safeParse(localStorage.getItem(k))||[];}
function save(k,v){localStorage.setItem(k,JSON.stringify(v));}
function toast(m){const t=document.getElementById("toast");t.textContent=m;t.classList.add("show");setTimeout(()=>t.classList.remove("show"),2500);}

const ACTIVE_ORG = localStorage.getItem("active_org") || "FLAWLESS";
const EMP_KEY = `${ACTIVE_ORG}_employees`;
const ATT_KEY = `${ACTIVE_ORG}_attendance`;
const ANN_KEY = `${ACTIVE_ORG}_announcements`;
const PAY_KEY = `${ACTIVE_ORG}_payroll`;            // <— used by FINANCE
const ACT_KEY = `${ACTIVE_ORG}_activity`;

["employees","attendance","announcements","payroll","activity"].forEach(tbl=>{
    const key = `${ACTIVE_ORG}_${tbl}`;
    if(!localStorage.getItem(key)) save(key,[]);
});

/* SIDEBAR FIX (FULL SWITCHER) */
document.querySelectorAll(".nav-item").forEach(item=>{
    item.addEventListener("click",()=>{
        document.querySelectorAll(".section").forEach(sec=>sec.style.display="none");
        const page=item.textContent.trim().toLowerCase();
        if(page.includes("dashboard")) show("mainDashboard");
        if(page.includes("employee")) show("employeeSection");
        if(page.includes("attendance")) show("attendanceSection");
        if(page.includes("payroll")) show("payrollSection");
        if(page.includes("announcement")) show("announcementSection");
        if(page.includes("analytics")) show("analyticsSection");
        if(page.includes("messages")) show("messageSection");
        if(page.includes("settings")) show("settingsSection");
    });
});
function show(id){document.getElementById(id).style.display="block";}

/* RENDER FUNCTIONS */
function renderEmployees(){
    const emp=read(EMP_KEY);
    const tbody=document.getElementById("employeeTable");
    tbody.innerHTML="";
    emp.forEach(e=>{
        tbody.innerHTML+=`
            <tr>
                <td>${e.name}</td>
                <td>${e.role}</td>
                <td>${e.email}</td>
                <td>₵${Number(e.salary).toLocaleString()}</td>
                <td>${e.lastStatus||"—"}</td>
            </tr>`;
    });
}

function renderAttendance(){
    const a=read(ATT_KEY);
    const tbody=document.getElementById("attendanceTable");
    tbody.innerHTML="";
    a.forEach(r=>{
        tbody.innerHTML+=`
            <tr>
                <td>${r.name}</td>
                <td>${r.date}</td>
                <td>${r.action}</td>
            </tr>
        `;
    });
}

function renderAnnouncements(){
    const a=read(ANN_KEY);
    const ul=document.getElementById("announcementList");
    ul.innerHTML="";
    a.forEach(n=>{
        ul.innerHTML+=`<li><b>${n.title}</b> — <small>${new Date(n.time).toLocaleString()}</small></li>`;
    });
}

function updateKPIs(){
    const emp=read(EMP_KEY);
    const att=read(ATT_KEY);
    const today=new Date().toISOString().split("T")[0];
    const present = att.filter(a=>a.date.includes(today)&&a.action==="in").length;

    document.getElementById("totalEmployees").textContent = emp.length;
    document.getElementById("presentToday").textContent = present;
    document.getElementById("absentToday").textContent = emp.length-present;

    const totalPayroll = emp.reduce((s,e)=>s+Number(e.salary),0);
    document.getElementById("payrollTotal").textContent = "₵"+totalPayroll.toLocaleString();
}

/* CHARTS */
let attendanceChart,payrollChart;
function updateCharts(){
    const ctx1=document.getElementById("attendanceChart").getContext("2d");
    const ctx2=document.getElementById("payrollChart").getContext("2d");
    if(attendanceChart) attendanceChart.destroy();
    if(payrollChart) payrollChart.destroy();

    attendanceChart = new Chart(ctx1,{
        type:"bar",
        data:{
            labels:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],
            datasets:[{label:"Attendance",data:[4,6,5,7,8,2,0],backgroundColor:"#0059ff"}]
        }
    });

    payrollChart = new Chart(ctx2,{
        type:"line",
        data:{
            labels:["Jan","Feb","Mar","Apr","May"],
            datasets:[{
                label:"Payroll Trend",
                borderColor:"#00c37a",
                backgroundColor:"rgba(0,195,122,.3)",
                fill:true,
                data:[12000,14500,13900,15500,18000]
            }]
        }
    });
}

/* ADD EMPLOYEE */
document.getElementById("addEmployeeBtn").addEventListener("click",()=>{
    const name=prompt("Employee Name:"); if(!name)return;
    const role=prompt("Role:"); if(!role)return;
    const email=prompt("Email:"); if(!email)return;
    const salary=prompt("Salary (GHS):"); if(!salary)return;

    const list=read(EMP_KEY);
    list.push({id:"E"+Date.now(),name,role,email,salary});
    save(EMP_KEY,list);
    toast("Employee added.");
    renderEmployees();updateKPIs();updateCharts();
});

/* POST ANNOUNCEMENT */
document.getElementById("postAnnouncement").addEventListener("click",()=>{
    const text=document.getElementById("announcementInput").value.trim();
    if(!text) return toast("Enter a message first");
    const list=read(ANN_KEY);
    list.push({title:text,time:new Date().toISOString()});
    save(ANN_KEY,list);
    renderAnnouncements();
    document.getElementById("announcementInput").value="";
});

/* RESET */
document.getElementById("clearData").addEventListener("click",()=>{
    if(!confirm("Reset ALL HR DATA?"))return;
    localStorage.removeItem(EMP_KEY);
    localStorage.removeItem(ATT_KEY);
    localStorage.removeItem(ANN_KEY);
    localStorage.removeItem(PAY_KEY);
    location.reload();
});

/* ------------------------------- */
/*  PAYROLL WORKFLOW (NEW!)       */
/* ------------------------------- */
/* HR presses "Generate Payroll" → Finance Dashboard sees pending payroll */

document.getElementById("generatePayrollBtn").addEventListener("click",()=>{
    const employees = read(EMP_KEY);
    if(!employees.length) return toast("No employees found.");

    const payroll = employees.map(e=>({
        id:e.id,
        name:e.name,
        salary:e.salary,
        status:"pending",         // <— finance will approve this
        month:new Date().toISOString().slice(0,7),
        created:Date.now()
    }));

    save(PAY_KEY,payroll);
    toast("Payroll sent to FINANCE for approval.");
    renderPayrollList();
});

function renderPayrollList(){
    const list=read(PAY_KEY);
    const tbody=document.getElementById("payrollList");
    tbody.innerHTML="";
    list.forEach(p=>{
        tbody.innerHTML+=`
            <tr>
                <td>${p.name}</td>
                <td>₵${Number(p.salary).toLocaleString()}</td>
                <td>${p.status}</td>
            </tr>
        `;
    });
}

/* SYNC ATTENDANCE */
window.addEventListener("storage",(e)=>{
    if(e.key===ATT_KEY){
        renderEmployees();
        updateKPIs();
        updateCharts();
    }
});

/* INIT */
function loadAll(){
    show("mainDashboard");
    renderEmployees();
    renderAttendance();
    renderAnnouncements();
    renderPayrollList();
    updateKPIs();
    updateCharts();
}
loadAll();
</script>

</body>
</html>
