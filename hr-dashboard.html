<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>HR Dashboard — Professional Sync Suite</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
/* ----  BEAUTIFUL MODERN UI STYLE  ---- */
:root{
  --primary:#0057b8;
  --accent:#10b981;
  --danger:#ef4444;
  --bg:#f3f5f8;
  --sidebar:#0c1427;
  --card:#ffffff;
  --radius:14px;
}

body{
  margin:0;
  font-family:Inter,Arial;
  background:var(--bg);
  display:flex;
  height:100vh;
}

/* SIDEBAR */
.sidebar{
  width:260px;
  background:var(--sidebar);
  color:white;
  display:flex;
  flex-direction:column;
  padding-top:20px;
}
.sidebar h2{
  text-align:center;
  margin:0 0 20px 0;
}
.nav-item{
  padding:14px 20px;
  cursor:pointer;
  display:flex;
  align-items:center;
  gap:14px;
  transition:.2s;
  color:#cbd5e1;
}
.nav-item:hover{
  background:#162544;
  color:white;
}

/* CONTENT */
.content{
  flex:1;
  padding:25px;
  overflow:auto;
}

/* CARD */
.card{
  background:var(--card);
  padding:20px;
  border-radius:var(--radius);
  margin-bottom:22px;
  box-shadow:0 4px 12px rgba(0,0,0,.1);
}

/* TABLE */
table{ width:100%; border-collapse:collapse; }
th,td{
  padding:10px;
  border-bottom:1px solid #e5e7eb;
}

/* TOAST */
#toast{
  position:fixed;
  right:25px;
  bottom:25px;
  background:black;
  color:white;
  padding:12px 16px;
  border-radius:var(--radius);
  opacity:0;
  transform:translateY(20px);
  transition:.3s;
}
#toast.show{ opacity:1; transform:none; }
</style>
</head>

<body>

<!-- ================= SIDEBAR ================ -->
<div class="sidebar">
  <h2>HR PANEL</h2>

  <div class="nav-item" data-target="dashboard"><i class="fa fa-home"></i> Dashboard</div>
  <div class="nav-item" data-target="employees"><i class="fa fa-users"></i> Employees</div>
  <div class="nav-item" data-target="attendance"><i class="fa fa-calendar-check"></i> Attendance</div>
  <div class="nav-item" data-target="notes"><i class="fa fa-book"></i> Teacher Notes</div>
  <div class="nav-item" data-target="timetable"><i class="fa fa-calendar-days"></i> Timetable</div>
  <div class="nav-item" data-target="sync"><i class="fa fa-sync"></i> Teacher Attendance Sync</div>
  <div class="nav-item" data-target="settings"><i class="fa fa-cog"></i> Settings</div>
</div>

<!-- ================= CONTENT ================ -->
<div class="content">

<!-- *********** DASHBOARD *********** -->
<div class="card section" id="dashboard">
  <h2>HR Dashboard — <span id="orgNameDisplay"></span></h2>

  <p>Total Employees: <b id="totalEmployees">0</b></p>
  <p>Present Today: <b id="presentToday">0</b></p>
  <p>Absent Today: <b id="absentToday">0</b></p>

  <canvas id="attendanceChart" height="120"></canvas>
</div>

<!-- *********** EMPLOYEES *********** -->
<div class="card section" id="employees" style="display:none;">
  <h2>Employees</h2>
  <table>
    <thead><tr><th>Name</th><th>Role</th><th>Email</th><th>Salary</th></tr></thead>
    <tbody id="employeeTable"></tbody>
  </table>
</div>

<!-- *********** ATTENDANCE *********** -->
<div class="card section" id="attendance" style="display:none;">
  <h2>Attendance Records</h2>
  <table>
    <thead><tr><th>Employee</th><th>Status</th><th>Time</th></tr></thead>
    <tbody id="attendanceTable"></tbody>
  </table>
</div>

<!-- *********** TEACHER NOTES *********** -->
<div class="card section" id="notes" style="display:none;">
  <h2>Teacher Notes</h2>
  <ul id="notesList"></ul>
</div>

<!-- *********** TIMETABLE *********** -->
<div class="card section" id="timetable" style="display:none;">
  <h2>Teacher Timetable</h2>
  <ul id="timetableList"></ul>
</div>

<!-- *********** SYNC PANEL *********** -->
<div class="card section" id="sync" style="display:none;">
  <h2>Teacher Attendance Sync</h2>
  <p>Automatically syncing attendance from <b>teacher-profile.html</b></p>
  <button id="forceSync" style="padding:10px 18px; border-radius:8px; border:none; background:var(--primary); color:white; cursor:pointer;">Run Manual Sync</button>
</div>

<div id="toast"></div>

</div>

<!-- ================= SCRIPT ================ -->
<script>
function showToast(msg){
  const t=document.getElementById("toast");
  t.textContent=msg;
  t.classList.add("show");
  setTimeout(()=>t.classList.remove("show"),2000);
}

/* ============ ORG KEYS ============ */
const ACTIVE_ORG = localStorage.getItem("active_org") || "FLAWLESS";
document.getElementById("orgNameDisplay").textContent = ACTIVE_ORG;

const EMP_KEY = ACTIVE_ORG + "_employees";
const ATT_KEY = ACTIVE_ORG + "_attendance";
const TEACH_ATT_KEY = ACTIVE_ORG + "_teacher_attendance";
const NOTES_KEY = ACTIVE_ORG + "_teacher_notes";
const TIME_KEY = ACTIVE_ORG + "_teacher_timetable";

/* ============ SYNC ENGINE ============ */
function syncTeacherAttendance(){
  const hrAtt = JSON.parse(localStorage.getItem(ATT_KEY) || "[]");
  const teacherAtt = JSON.parse(localStorage.getItem(TEACH_ATT_KEY) || "[]");

  let added = 0;
  teacherAtt.forEach(rec=>{
    const exists = hrAtt.some(h=>h.timestamp === rec.timestamp);
    if(!exists){
      hrAtt.push(rec);
      added++;
    }
  });

  localStorage.setItem(ATT_KEY, JSON.stringify(hrAtt));
  if(added>0) showToast(`Synced ${added} new records`);
}

/* ========== RENDER EMPLOYEES ========== */
function renderEmployees(){
  const arr = JSON.parse(localStorage.getItem(EMP_KEY)||"[]");
  const tbody=document.getElementById("employeeTable");
  tbody.innerHTML="";
  arr.forEach(emp=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${emp.name}</td><td>${emp.role}</td><td>${emp.email}</td><td>₵${emp.salary}</td>`;
    tbody.appendChild(tr);
  });
}

/* ========== RENDER ATTENDANCE ========== */
function renderAttendance(){
  syncTeacherAttendance();
  const arr = JSON.parse(localStorage.getItem(ATT_KEY)||"[]");
  const tbody=document.getElementById("attendanceTable");
  tbody.innerHTML="";
  arr.slice().reverse().forEach(a=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${a.name || a.employeeId}</td><td>${a.action}</td><td>${new Date(a.timestamp).toLocaleString()}</td>`;
    tbody.appendChild(tr);
  });
}

/* ========== RENDER NOTES ========== */
function renderNotes(){
  const arr = JSON.parse(localStorage.getItem(NOTES_KEY)||"[]");
  const ul=document.getElementById("notesList");
  ul.innerHTML="";
  arr.forEach(n=>{
    const li=document.createElement("li");
    li.innerHTML=`<b>${n.title}</b><br>${n.content}<br><small>${new Date(n.time).toLocaleString()}</small>`;
    ul.appendChild(li);
  });
}

/* ========== RENDER TIMETABLE ========== */
function renderTimetable(){
  const arr=JSON.parse(localStorage.getItem(TIME_KEY)||"[]");
  const ul=document.getElementById("timetableList");
  ul.innerHTML="";
  arr.forEach(t=>{
    const li=document.createElement("li");
    li.innerHTML=`<b>${t.day}</b> — ${t.subject} (${t.time})`;
    ul.appendChild(li);
  });
}

/* ========== KPIs ========== */
function updateKPIs(){
  const employees = JSON.parse(localStorage.getItem(EMP_KEY)||"[]");
  const attendance = JSON.parse(localStorage.getItem(ATT_KEY)||"[]");

  document.getElementById("totalEmployees").textContent = employees.length;

  const today = new Date().toISOString().split("T")[0];
  const present = attendance.filter(a => a.timestamp.startsWith(today) && a.action === "in").length;

  document.getElementById("presentToday").textContent = present;
  document.getElementById("absentToday").textContent = employees.length - present;
}

/* ========== NAVIGATION ========== */
document.querySelectorAll(".nav-item").forEach(item=>{
  item.addEventListener("click",()=>{
    const target=item.dataset.target;
    document.querySelectorAll(".section").forEach(sec=>sec.style.display="none");
    document.getElementById(target).style.display="block";

    if(target==="employees") renderEmployees();
    if(target==="attendance") renderAttendance();
    if(target==="notes") renderNotes();
    if(target==="timetable") renderTimetable();
  });
});

/* ========== CHART ========== */
function renderChart(){
  const attendance = JSON.parse(localStorage.getItem(ATT_KEY)||"[]");
  const ctx=document.getElementById("attendanceChart").getContext("2d");

  let days=[];
  let counts=[];
  for(let i=6;i>=0;i--){
    let d=new Date();
    d.setDate(d.getDate()-i);
    const key=d.toISOString().split("T")[0];
    days.push(key.slice(5));

    const c=attendance.filter(a=>a.timestamp.startsWith(key) && a.action==="in").length;
    counts.push(c);
  }

  new Chart(ctx,{
    type:"bar",
    data:{ labels:days, datasets:[{ label:"Present", data:counts, background:"#0057b8" }] },
    options:{ plugins:{legend:{display:false}} }
  });
}

document.getElementById("forceSync").addEventListener("click",()=>{
  syncTeacherAttendance();
  renderAttendance();
});

/* ========== INITIAL LOAD ========== */
syncTeacherAttendance();
updateKPIs();
renderChart();

</script>
</body>
</html>
