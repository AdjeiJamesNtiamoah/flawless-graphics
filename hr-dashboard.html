<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>HR Dashboard — Professional Edition</title>

<!-- Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<!-- jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
/* ----------------- COLORS ----------------- */
:root {
  --primary:#0057b8;
  --primary-light:#3b82f6;
  --accent:#10b981;
  --danger:#ef4444;
  --bg:#f6f9fc;
  --sidebar-bg:#0c1427;
  --sidebar-hover:#162544;
  --text-dark:#1e293b;
  --text-muted:#6b7280;
  --card-bg:#ffffff;
  --radius:14px;
}

/* Dark Mode */
.dark {
  --bg:#0d1117;
  --card-bg:#161b22;
  --sidebar-bg:#0b0f14;
  --sidebar-hover:#1c2533;
  --text-dark:#e5e7eb;
  --text-muted:#94a3b8;
  --primary:#3b82f6;
}

/* BASE */
body {
  margin:0;
  background:var(--bg);
  font-family:Inter,Roboto,Arial;
  color:var(--text-dark);
  display:flex;
  height:100vh;
  overflow:hidden;
}

/* ----------------- SIDEBAR ----------------- */
.sidebar {
  width:250px;
  background:var(--sidebar-bg);
  color:white;
  display:flex;
  flex-direction:column;
  padding:20px 0;
  height:100vh;
  box-shadow:4px 0 18px rgba(0,0,0,.15);
}

.sidebar h2 {
  margin:0;
  text-align:center;
  font-size:20px;
  margin-bottom:25px;
  letter-spacing:1px;
  font-weight:700;
}

.nav-item {
  padding:14px 22px;
  cursor:pointer;
  display:flex;
  align-items:center;
  gap:12px;
  color:#cbd5e1;
  transition:.2s;
}

.nav-item:hover { background:var(--sidebar-hover); color:white; }
.nav-item.active { background:var(--sidebar-hover); color:white; }

.nav-item i { width:22px; }

/* ---------------- CONTENT ---------------- */
.content {
  flex:1;
  overflow:auto;
  padding:25px;
}

/* ---------------- HEADER ---------------- */
.header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:22px;
}

.header .title {
  font-size:26px;
  font-weight:700;
}

.header-right {
  display:flex;
  align-items:center;
  gap:12px;
}

.select {
  padding:8px 10px;
  border-radius:var(--radius);
  border:1px solid #d1d5db;
  background:white;
}

.btn {
  padding:8px 14px;
  border-radius:var(--radius);
  cursor:pointer;
  border:none;
  background:var(--primary);
  color:white;
  font-weight:600;
  transition:.2s;
}

.btn:hover { opacity:.85; }

.btn.light { background:#e5e7eb; color:#1e293b; }
.btn.danger { background:var(--danger); }

/* CARDS */
.grid { display:grid; gap:18px; }

.kpi {
  background:var(--card-bg);
  padding:20px;
  border-radius:var(--radius);
  display:flex;
  align-items:center;
  gap:18px;
  box-shadow:0 4px 14px rgba(0,0,0,.08);
}

.kpi i {
  font-size:28px;
  padding:18px;
  border-radius:50%;
  background:rgba(59,130,246,.12);
  color:var(--primary);
}

.kpi .value { font-size:26px; font-weight:700; }
.kpi .label { font-size:14px; color:var(--text-muted); }

.page { display:none; }
.page.active { display:block; }

/* Card Wrapper */
.card {
  background:var(--card-bg);
  padding:22px;
  border-radius:var(--radius);
  box-shadow:0 6px 18px rgba(0,0,0,.06);
  margin-bottom:22px;
}

.card-title { font-size:20px; font-weight:700; margin-bottom:10px; }

/* Table */
table { width:100%; border-collapse:collapse; }
th,td { padding:10px; text-align:left; border-bottom:1px solid #e5e7eb; font-size:14px; }

/* Toast */
#toast {
  position:fixed;
  right:30px;
  bottom:30px;
  padding:14px 18px;
  background:#1e293b;
  color:white;
  border-radius:var(--radius);
  opacity:0;
  transform:translateY(20px);
  transition:.3s;
}
#toast.show { opacity:1; transform:none; }

</style>
</head>

<body>

<!-- SIDEBAR -->
<div class="sidebar">
  <h2>HR PANEL</h2>

  <div class="nav-item active" data-page="dashboard"><i class="fa fa-home"></i> Dashboard</div>
  <div class="nav-item" data-page="employees"><i class="fa fa-users"></i> Employees</div>
  <div class="nav-item" data-page="attendance"><i class="fa fa-calendar-check"></i> Attendance</div>
  <div class="nav-item" data-page="payroll"><i class="fa fa-sack-dollar"></i> Payroll</div>
  <div class="nav-item" data-page="announcements"><i class="fa fa-bullhorn"></i> Announcements</div>
  <div class="nav-item" data-page="activity"><i class="fa fa-list"></i> Activity Log</div>
  <div class="nav-item" data-page="settings"><i class="fa fa-cog"></i> Settings</div>
</div>

<!-- CONTENT -->
<div class="content">

<!-- HEADER -->
<div class="header">
  <div class="title">HR Dashboard — <span id="orgNameDisplay">FLAWLESS</span></div>

  <div class="header-right">
    <select id="orgSwitcher" class="select"></select>
    <button class="btn light" id="toggleTheme"><i class="fa fa-moon"></i></button>
    <button class="btn" id="exportPDF">Export PDF</button>
    <button class="btn danger" id="clearData">Reset</button>
  </div>
</div>

<!-- ========================= PAGE: DASHBOARD ========================= -->
<div id="page-dashboard" class="page active">

  <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); margin-bottom:22px;">
    <div class="kpi">
      <i class="fa fa-users"></i>
      <div>
        <div class="value" id="totalEmployees">0</div>
        <div class="label">Total Employees</div>
      </div>
    </div>

    <div class="kpi">
      <i class="fa fa-user-check"></i>
      <div>
        <div class="value" id="presentToday">0</div>
        <div class="label">Present Today</div>
      </div>
    </div>

    <div class="kpi">
      <i class="fa fa-user-xmark"></i>
      <div>
        <div class="value" id="absentToday">0</div>
        <div class="label">Absent Today</div>
      </div>
    </div>

    <div class="kpi">
      <i class="fa fa-sack-dollar"></i>
      <div>
        <div class="value" id="payrollTotal">₵0</div>
        <div class="label">Monthly Payroll</div>
      </div>
    </div>
  </div>

</div>

<!-- ========================= PAGE: EMPLOYEES ========================= -->
<div id="page-employees" class="page">

  <div class="card">
    <div class="card-title">Employee List</div>
    <button class="btn" id="addEmployeeBtn"><i class="fa fa-plus"></i> Add Employee</button>
    <br><br>

    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Role</th>
          <th>Email</th>
          <th>Salary</th>
          <th>Attendance</th>
        </tr>
      </thead>
      <tbody id="employeeTable"></tbody>
    </table>
  </div>

</div>

<!-- ========================= PAGE: ATTENDANCE ========================= -->
<div id="page-attendance" class="page">

  <div class="card">
    <div class="card-title">Attendance Overview</div>
    <canvas id="attendanceChart" height="140"></canvas>
  </div>

</div>

<!-- ========================= PAGE: PAYROLL ========================= -->
<div id="page-payroll" class="page">

  <div class="card">
    <div class="card-title">Payroll Summary</div>
    <canvas id="payrollChart" height="140"></canvas>
  </div>

</div>

<!-- ========================= PAGE: ANNOUNCEMENTS ========================= -->
<div id="page-announcements" class="page">

  <div class="card">

    <div class="card-title">Announcements</div>

    <div style="display:flex; gap:10px;">
      <input id="announcementInput" placeholder="Write announcement..." style="
        flex:1; padding:10px; border-radius:var(--radius); border:1px solid #d1d5db;">
      <button class="btn" id="postAnnouncement">Post</button>
    </div>

    <ul id="announcementList" style="margin-top:15px; padding-left:20px;"></ul>
  </div>

</div>

<!-- ========================= PAGE: ACTIVITY ========================= -->
<div id="page-activity" class="page">

  <div class="card">
    <div class="card-title">Activity Log</div>
    <ul id="activityLog" style="padding-left:20px;"></ul>
  </div>

</div>

<!-- ========================= PAGE: SETTINGS ========================= -->
<div id="page-settings" class="page">

  <div class="card">
    <div class="card-title">Settings</div>
    <p>Future settings will go here.</p>
  </div>

</div>

</div> <!-- END CONTENT -->

<div id="toast"></div>

<!-- ======================== JAVASCRIPT ======================== -->
<script>
console.log("HR Dashboard Loaded");

/* UTILITIES */
function safeParse(s){ try{return JSON.parse(s);}catch(e){return null;} }
function read(k){ return safeParse(localStorage.getItem(k)) || []; }
function save(k,v){ localStorage.setItem(k, JSON.stringify(v)); }
function showToast(msg){
  const t=document.getElementById('toast');
  t.textContent=msg;
  t.classList.add('show');
  setTimeout(()=>t.classList.remove('show'),2500);
}

/* ORG HANDLING */
const ACTIVE_ORG = localStorage.getItem('active_org') || 'FLAWLESS';
document.getElementById('orgNameDisplay').textContent = ACTIVE_ORG;

const EMP_KEY = `${ACTIVE_ORG}_employees`;
const ATT_KEY = `${ACTIVE_ORG}_attendance`;
const PAY_KEY = `${ACTIVE_ORG}_payments`;
const ANN_KEY = `${ACTIVE_ORG}_announcements`;
const ACT_KEY = `${ACTIVE_ORG}_activity`;

if(!localStorage.getItem(EMP_KEY)) save(EMP_KEY, []);
if(!localStorage.getItem(ATT_KEY)) save(ATT_KEY, []);
if(!localStorage.getItem(PAY_KEY)) save(PAY_KEY, []);
if(!localStorage.getItem(ANN_KEY)) save(ANN_KEY, []);
if(!localStorage.getItem(ACT_KEY)) save(ACT_KEY, []);

/* ACTIVITY */
function pushActivity(msg){
  const arr = read(ACT_KEY);
  arr.push({ text:msg, time:new Date().toISOString() });
  save(ACT_KEY, arr);
  renderActivity();
}

/* EMPLOYEES */
function renderEmployees(){
  const list = read(EMP_KEY);
  const table = document.getElementById('employeeTable');
  table.innerHTML = '';
  const att = read(ATT_KEY);
  const today = new Date().toISOString().split("T")[0];

  list.forEach(emp=>{
    const todays = att.filter(a=>a.employeeId===emp.id && a.date.startsWith(today));
    const status = todays.length ? (todays[todays.length-1].action==="in"?"IN":"OUT") : "—";

    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${emp.name}</td>
      <td>${emp.role}</td>
      <td>${emp.email}</td>
      <td>₵ ${Number(emp.salary).toLocaleString()}</td>
      <td>${status}</td>
    `;
    table.appendChild(tr);
  });
}

/* ADD EMPLOYEE */
document.getElementById('addEmployeeBtn').onclick = () =>{
  const name = prompt("Name?");
  if(!name) return;
  const role = prompt("Role?", "Staff") || "Staff";
  const email = prompt("Email?", "") || "";
  const salary = Number(prompt("Salary?","0")) || 0;

  const list = read(EMP_KEY);
  list.push({ id:"e_"+Date.now(), name, role, email, salary });
  save(EMP_KEY, list);

  pushActivity(`Added employee ${name}`);
  renderEmployees(); updateKPIs(); updateCharts();
};

/* KPI UPDATE */
function updateKPIs(){
  const emps = read(EMP_KEY);
  const att = read(ATT_KEY);

  const today = new Date().toISOString().split("T")[0];
  const present = new Set(att.filter(a=>a.date.startsWith(today)&&a.action==='in').map(a=>a.employeeId));

  document.getElementById('totalEmployees').textContent = emps.length;
  document.getElementById('presentToday').textContent = present.size;
  document.getElementById('absentToday').textContent = Math.max(0, emps.length - present.size);
  document.getElementById('payrollTotal').textContent =
    "₵"+emps.reduce((n,e)=>n+Number(e.salary),0).toLocaleString();
}

/* CHARTS */
let attendanceChart=null, payrollChart=null;

function updateCharts(){
  const att=read(ATT_KEY);
  const days=[];
  for(let i=6;i>=0;i--){
    const d=new Date(); d.setDate(d.getDate()-i);
    days.push(d.toISOString().split("T")[0]);
  }
  const data=days.map(d=>{
    return new Set(att.filter(a=>a.date.startsWith(d)&&a.action==='in').map(a=>a.employeeId)).size;
  });

  const ctx1=document.getElementById('attendanceChart');
  if(attendanceChart) attendanceChart.destroy();
  attendanceChart=new Chart(ctx1,{
    type:'bar',
    data:{labels:days.map(d=>d.slice(5)),datasets:[{data,backgroundColor:'#3b82f6'}]},
    options:{plugins:{legend:{display:false}}}
  });

  const emps=read(EMP_KEY);
  const months=[];
  const mlabels=[];
  const now=new Date();
  for(let i=5;i>=0;i--){
    const d=new Date(now.getFullYear(),now.getMonth()-i,1);
    months.push(d);
    mlabels.push(d.toLocaleString('default',{month:'short'}));
  }
  const payroll=months.map(()=>emps.reduce((n,e)=>n+Number(e.salary),0));

  const ctx2=document.getElementById('payrollChart');
  if(payrollChart) payrollChart.destroy();
  payrollChart=new Chart(ctx2,{
    type:'line',
    data:{labels:mlabels,datasets:[{data:payroll,borderColor:'#10b981',fill:true,backgroundColor:'rgba(16,185,129,0.12)'}]},
    options:{plugins:{legend:{display:false}}}
  });
}

/* ANNOUNCEMENTS */
function renderAnnouncements(){
  const list=read(ANN_KEY).reverse();
  const ul=document.getElementById('announcementList');
  ul.innerHTML='';
  list.forEach(a=>{
    const li=document.createElement('li');
    li.innerHTML = `<strong>${a.title}</strong> — <small>${new Date(a.time).toLocaleString()}</small><br>${a.body}`;
    ul.appendChild(li);
  });
}

document.getElementById('postAnnouncement').onclick = ()=>{
  const text=document.getElementById('announcementInput').value.trim();
  if(!text) return;

  const ann=read(ANN_KEY);
  ann.push({title:text,body:text,time:new Date().toISOString()});
  save(ANN_KEY,ann);
  document.getElementById('announcementInput').value='';

  pushActivity("Posted announcement");
  renderAnnouncements();
};

/* ACTIVITY */
function renderActivity(){
  const arr=read(ACT_KEY).reverse();
  const ul=document.getElementById('activityLog');
  ul.innerHTML='';
  arr.forEach(a=>{
    const li=document.createElement('li');
    li.innerHTML=`${a.text} — <small>${new Date(a.time).toLocaleString()}</small>`;
    ul.appendChild(li);
  });
}

/* PAGE SWITCHING */
document.querySelectorAll('.nav-item').forEach(item=>{
  item.addEventListener('click',()=>{
    const page=item.getAttribute('data-page');

    document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
    document.getElementById(`page-${page}`).classList.add('active');

    document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
    item.classList.add('active');
  });
});

/* DARK MODE */
document.getElementById('toggleTheme').onclick=()=>{
  document.documentElement.classList.toggle('dark');
  localStorage.setItem('hr_theme_dark',
    document.documentElement.classList.contains('dark') ? '1':'0'
  );
};
if(localStorage.getItem('hr_theme_dark')==="1")
  document.documentElement.classList.add('dark');

/* EXPORT PDF */
document.getElementById('exportPDF').onclick=()=>{
  const doc=new jsPDF();
  doc.text(`${ACTIVE_ORG} - HR Report`,20,20);
  doc.save(`${ACTIVE_ORG}_hr_report.pdf`);
};

/* RESET */
document.getElementById('clearData').onclick=()=>{
  if(!confirm("Reset all HR data?")) return;
  save(EMP_KEY,[]); save(ATT_KEY,[]); save(PAY_KEY,[]);
  save(ANN_KEY,[]); save(ACT_KEY,[]);
  renderAll(); showToast("Reset complete");
};

/* RENDER ALL */
function renderAll(){
  renderEmployees();
  updateKPIs();
  updateCharts();
  renderAnnouncements();
  renderActivity();
}
renderAll();

</script>

</body>
</html>
