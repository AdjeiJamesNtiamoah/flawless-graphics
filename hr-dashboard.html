<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FLAWLESS GRAPHICS | Employee Management System</title>
  <link rel="stylesheet" href="style.css" />
</head>
  <script src="theme.js"></script>
</body>
  <header>
    <nav class="navbar">
      <img src="logo.gif" alt="FLAWLESS GRAPHICS Logo" class="logo-img">
      <h1>FLAWLESS GRAPHICS</h1>
      <p class="tagline">TRUTH AND SERVICE</p>
      </div>
<ul>
  <li><a href="index.html">Home</a></li>
  <li><a href="employee.html">Employee Portal</a></li>
  <li><a href="hr-dashboard.html"class="active">HR Dashboard</a></li>
  <li><a href="services.html">Services</a></li>
  <li><a href="contact.html">Contact</a></li>
</ul>

    </nav>
  </header>

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HR Dashboard | Flawless Graphics</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    * { box-sizing: border-box; font-family: 'Poppins', sans-serif; }
    body { margin: 0; background: #f4f7fb; }
    header { background: #002b6b; color: white; padding: 15px 30px; text-align: center; font-size: 22px; font-weight: 600; }

    .stats-container {
      display: flex; justify-content: space-around; flex-wrap: wrap; margin: 20px;
    }

    .stat-card {
      background: linear-gradient(135deg, #004aad, #007bff);
      color: white; width: 22%; min-width: 220px;
      border-radius: 10px; padding: 25px; text-align: center;
      transition: transform 0.3s ease, box-shadow 0.3s ease; cursor: pointer;
    }

    .stat-card:hover { transform: translateY(-5px); box-shadow: 0 8px 16px rgba(0,0,0,0.2); }
    .stat-card h2 { font-size: 36px; margin: 10px 0; }

    .sidebar {
      width: 230px; background: #002b6b; color: white;
      height: 100vh; position: fixed; top: 0; left: 0; padding-top: 100px;
    }

    .sidebar a {
      display: block; color: white; text-decoration: none;
      padding: 14px 25px; font-weight: 500; transition: background 0.3s;
    }

    .sidebar a:hover { background: #004aad; }

    .main-content { margin-left: 240px; padding: 20px; }
    .main-content h2 { font-weight: 600; color: #002b6b; }

    .modal {
      display: none; position: fixed; z-index: 999; padding-top: 80px;
      left: 0; top: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6);
    }

    .modal-content {
      background: white; margin: auto; padding: 20px; border-radius: 10px;
      width: 90%; max-width: 900px; animation: fadeIn 0.4s ease; position: relative;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }

    .close { color: #333; font-size: 28px; font-weight: bold; position: absolute; right: 20px; top: 10px; cursor: pointer; }
    .close:hover { color: #007bff; }

    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    table th, table td { border: 1px solid #ccc; padding: 10px; text-align: left; }
    table th { background: #007bff; color: white; position: sticky; top: 0; }

    .btn {
      background: #007bff; color: white; border: none; padding: 10px 15px;
      border-radius: 5px; cursor: pointer; transition: 0.3s; margin-right: 10px;
    }
    .btn:hover { background: #0056b3; }

    select, input {
      padding: 8px; border: 1px solid #ccc; border-radius: 5px;
      font-size: 14px; margin-top: 5px;
    }

  </style>
</head>

<body>
  <header>Flawless Graphics HR Dashboard</header>

  <div class="sidebar">
    <a href="#" data-modal="employeeModal">Employee Report</a>
    <a href="#" data-modal="paymentModal">Payment Portal</a>
    <a href="#" data-modal="attendanceModal">Attendance Summary</a>
    <a href="#" data-modal="payrollModal">Payroll Analytics</a>
    <a href="#" data-modal="performanceTrendsModal">Performance Trends</a>
    <a href="#" data-modal="ratePerformanceModal">Rate Employee</a>
  </div>

  <div class="main-content">
    <div class="stats-container">
      <div class="stat-card"><h2 id="totalEmployees">0</h2><p>Total Employees</p></div>
      <div class="stat-card"><h2 id="totalDepartments">0</h2><p>Departments</p></div>
      <div class="stat-card"><h2 id="attendanceRate">0%</h2><p>Attendance Rate</p></div>
      <div class="stat-card"><h2 id="totalPayroll">$0</h2><p>Total Payroll</p></div>
      <div class="stat-card" id="topDeptCard"><h2 id="topDepartment">N/A</h2><p>Top Performing Department</p></div>
    </div>
  </div>

  <!-- Department Breakdown Modal -->
  <div id="departmentModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2>Department Performance Breakdown</h2>
      <label>Select Department:</label>
      <select id="deptSelect"></select>
      <button class="btn" id="loadDeptPerformance">Load</button>
      <button class="btn" id="downloadDeptReport">Download as PDF</button>

      <table id="deptTable">
        <thead>
          <tr>
            <th>No.</th>
            <th>Employee Name</th>
            <th>Average Score</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <h3 id="deptAverage">Average Score: 0%</h3>
    </div>
  </div>

  <script>
  // === Load Stats ===
  function animateCounter(id, start, end, prefix = "", suffix = "", duration = 1000) {
    const el = document.getElementById(id);
    let startTime = null;
    function step(time) {
      if (!startTime) startTime = time;
      const progress = Math.min((time - startTime) / duration, 1);
      const val = Math.floor(progress * (end - start) + start);
      el.textContent = prefix + val + suffix;
      if (progress < 1) requestAnimationFrame(step);
    }
    requestAnimationFrame(step);
  }

  function loadDashboardStats() {
    const employees = JSON.parse(localStorage.getItem("employees")) || [];
    const performanceData = JSON.parse(localStorage.getItem("performanceData")) || {};
    const totalEmployees = employees.length;
    const departments = [...new Set(employees.map(e => e.department || ""))];
    const totalDepartments = departments.length;
    const attendanceRate = totalEmployees ? Math.round((Math.random() * 30) + 70) : 0;
    const payrollData = JSON.parse(localStorage.getItem("payments")) || [];
    const totalPayroll = payrollData.reduce((sum, p) => sum + (parseFloat(p.amount) || 0), 0);
    const deptPerformance = {};

    for (const emp of employees) {
      const dept = emp.department || "General";
      const scores = performanceData[emp.fullName]
        ? Object.values(performanceData[emp.fullName]).map(Number)
        : [];
      const avgScore = scores.length ? scores.reduce((a, b) => a + b, 0) / scores.length : 0;
      if (!deptPerformance[dept]) deptPerformance[dept] = [];
      deptPerformance[dept].push(avgScore);
    }

    let topDept = "N/A";
    let topScore = 0;
    for (const [dept, scores] of Object.entries(deptPerformance)) {
      const avg = scores.length ? scores.reduce((a, b) => a + b, 0) / scores.length : 0;
      if (avg > topScore) { topScore = avg; topDept = `${dept} (${avg.toFixed(1)}%)`; }
    }

    animateCounter("totalEmployees", 0, totalEmployees);
    animateCounter("totalDepartments", 0, totalDepartments);
    animateCounter("attendanceRate", 0, attendanceRate, "", "%");
    animateCounter("totalPayroll", 0, totalPayroll, "$");
    document.getElementById("topDepartment").textContent = topDept;

    const deptSelect = document.getElementById("deptSelect");
    deptSelect.innerHTML = "";
    departments.forEach(d => {
      const opt = document.createElement("option");
      opt.value = d;
      opt.textContent = d;
      deptSelect.appendChild(opt);
    });
  }

  document.addEventListener("DOMContentLoaded", loadDashboardStats);

  // === Modal Logic ===
  const modal = document.getElementById("departmentModal");
  const topDeptCard = document.getElementById("topDeptCard");
  const closeBtn = document.querySelector("#departmentModal .close");
  topDeptCard.addEventListener("click", () => { modal.style.display = "block"; });
  closeBtn.onclick = () => modal.style.display = "none";
  window.onclick = e => { if (e.target === modal) modal.style.display = "none"; };

  // === Department Breakdown with Animation ===
  document.getElementById("loadDeptPerformance").addEventListener("click", () => {
    const dept = document.getElementById("deptSelect").value;
    const employees = JSON.parse(localStorage.getItem("employees")) || [];
    const performanceData = JSON.parse(localStorage.getItem("performanceData")) || {};
    const deptEmployees = employees.filter(e => e.department === dept);
    const tbody = document.querySelector("#deptTable tbody");
    tbody.innerHTML = "";

    let total = 0;
    deptEmployees.forEach((emp, i) => {
      const scores = performanceData[emp.fullName]
        ? Object.values(performanceData[emp.fullName]).map(Number)
        : [];
      const avgScore = scores.length ? (scores.reduce((a,b)=>a+b,0)/scores.length).toFixed(1) : "0";
      total += parseFloat(avgScore);
      const row = document.createElement("tr");
      row.innerHTML = `<td>${i+1}</td><td>${emp.fullName}</td><td>${avgScore}%</td>`;
      tbody.appendChild(row);

      // Highlight animation
      row.style.backgroundColor = "#d1ffd1";
      setTimeout(() => { row.style.transition = "background 1s"; row.style.backgroundColor = "white"; }, 300);
    });

    const avgDept = deptEmployees.length ? (total / deptEmployees.length).toFixed(1) : 0;
    const avgEl = document.getElementById("deptAverage");
    avgEl.textContent = `Average Score: ${avgDept}%`;
    avgEl.style.opacity = 0;
    avgEl.style.transition = "opacity 0.5s ease-in";
    setTimeout(() => { avgEl.style.opacity = 1; }, 100);
  });

  // === PDF Export ===
  document.getElementById("downloadDeptReport").addEventListener("click", () => {
    const { jsPDF } = window.jspdf;
    const pdf = new jsPDF();
    pdf.text("Department Performance Report", 14, 15);
    const table = document.getElementById("deptTable");
    let y = 25;
    for (let i = 0; i < table.rows.length; i++) {
      const row = [...table.rows[i].cells].map(td => td.innerText).join("  |  ");
      pdf.text(row, 14, y);
      y += 8;
    }
    pdf.save("department_performance.pdf");
  });
</script>
</body>
</html>
