<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Teacher Profile â€” Flawless Graphics</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
body{
    margin:0;
    font-family:'Poppins',sans-serif;
    background:#f5f7fb;
}
.topbar{
    background:#0b63a3;
    color:#fff;
    padding:14px 20px;
    display:flex;
    justify-content:space-between;
    align-items:center;
}
.topbar h2{ margin:0; font-size:20px; font-weight:600 }
.container{
    max-width:900px;
    margin:20px auto;
    padding:12px;
}
.card{
    background:#fff;
    padding:20px;
    border-radius:14px;
    margin-bottom:20px;
    box-shadow:0 6px 18px rgba(0,0,0,0.08);
}
h3{ margin-top:0; font-weight:600 }
.row{
    display:flex;
    gap:20px;
    flex-wrap:wrap;
}
.info-box{
    flex:1;
    min-width:260px;
    background:#eef5ff;
    padding:16px;
    border-radius:12px;
}
.label{ font-size:13px; color:#666 }
.value{ font-size:16px; font-weight:600; margin-top:3px }
.btn{
    padding:10px 14px;
    background:#0b63a3;
    color:#fff;
    border:0;
    border-radius:8px;
    cursor:pointer;
}
.btn.red{ background:#c62828 }
.center{ text-align:center }
.small{ font-size:13px; color:#666; margin-top:6px }
</style>
</head>

<body>

<script>
// ---------------- SESSION PROTECTION ----------------
const teacher = JSON.parse(localStorage.getItem("teacher_active_user"));
if (!teacher) {
    window.location.href = "teacher-login.html";
}
</script>

<div class="topbar">
    <h2>Teacher Dashboard</h2>
    <button class="btn red" onclick="logout()">Logout</button>
</div>

<div class="container">

    <!-- PROFILE CARD -->
    <div class="card">
        <h3>Your Profile</h3>
        <div class="row">
            <div class="info-box">
                <div class="label">Full Name</div>
                <div class="value" id="nameBox">Loading...</div>
            </div>

            <div class="info-box">
                <div class="label">Email</div>
                <div class="value" id="emailBox">Loading...</div>
            </div>

            <div class="info-box">
                <div class="label">Organization</div>
                <div class="value" id="orgBox">Loading...</div>
            </div>
        </div>
    </div>

    <!-- CLASSES CARD -->
    <div class="card">
        <h3>Your Assigned Classes</h3>
        <div id="classesList" class="small">Loading...</div>
    </div>

    <!-- ATTENDANCE SUMMARY -->
    <div class="card">
        <h3>Attendance Summary</h3>
        <div id="attendanceSummary" class="small">Loading...</div>
    </div>

    <!-- BACK TO TEACHER MENU -->
    <div class="center">
        <button class="btn" onclick="window.location.href='teacher.html'">Return to Teacher Management</button>
    </div>

</div>

<script>
/* UTILS */
function safeParse(s){ try{return JSON.parse(s)}catch(e){return null} }
function read(k){ return safeParse(localStorage.getItem(k)) || [] }

const ACTIVE_ORG = teacher.org || localStorage.getItem("active_org") || "default_org";
const TEACH_KEY  = `${ACTIVE_ORG}_teachers`;
const ATT_KEY    = `${ACTIVE_ORG}_teacher_attendance`;

/* LOAD PROFILE DATA */
document.getElementById("nameBox").textContent  = teacher.name;
document.getElementById("emailBox").textContent = teacher.email;
document.getElementById("orgBox").textContent   = ACTIVE_ORG;

/* LOAD CLASSES */
function loadClasses(){
    const teachers = read(TEACH_KEY);
    const obj = teachers.find(t => t.email === teacher.email);

    if (!obj){
        document.getElementById("classesList").textContent = "No class data found.";
        return;
    }

    const classes = obj.classes || [];
    document.getElementById("classesList").innerHTML =
        classes.length ? classes.join(", ") : "No assigned classes.";
}

/* LOAD ATTENDANCE SUMMARY */
function loadAttendance(){
    const list = read(ATT_KEY);
    const teacherIndex = read(TEACH_KEY).findIndex(t => t.email === teacher.email);
    if (teacherIndex === -1){
        document.getElementById("attendanceSummary").textContent = "Attendance not available.";
        return;
    }

    const entries = list.filter(a => a.employeeIndex === teacherIndex);
    if (!entries.length){
        document.getElementById("attendanceSummary").textContent = "No attendance recorded.";
        return;
    }

    let days = new Set(entries.map(e => e.date.split("T")[0]));
    document.getElementById("attendanceSummary").innerHTML = `
        Total recorded days: <strong>${days.size}</strong><br>
        Total actions (in/out): <strong>${entries.length}</strong>
    `;
}

/* LOGOUT FUNCTION */
function logout(){
    localStorage.removeItem("teacher_active_user");
    window.location.href = "teacher-login.html";
}

/* INITIAL LOAD */
loadClasses();
loadAttendance();
</script>

</body>
</html>
