<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Teacher Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
    body {
        margin:0;
        font-family:Poppins, sans-serif;
        background:#f3f7ff;
        display:flex;
    }

    /* SIDEBAR */
    .sidebar {
        width:250px;
        background:#061a3a;
        height:100vh;
        color:white;
        padding:20px;
        position:fixed;
        left:0;
        top:0;
        box-shadow:4px 0 12px rgba(0,0,0,0.2);
    }

    .sidebar h2 {
        font-size:20px;
        margin-bottom:15px;
        text-align:center;
    }

    .sidebar a {
        display:block;
        padding:12px;
        margin-bottom:8px;
        background:#0e2f62;
        color:white;
        text-decoration:none;
        border-radius:8px;
        transition:0.3s;
    }

    .sidebar a:hover {
        background:#13498f;
    }

    /* MAIN CONTENT */
    .main {
        margin-left:260px;
        padding:20px;
        width:calc(100% - 260px);
    }

    .card {
        background:white;
        padding:20px;
        border-radius:10px;
        box-shadow:0 4px 10px rgba(0,0,0,0.1);
        margin-bottom:20px;
    }

    /* CLOCK-IN CARD */
    .attendance-box {
        background:#0d2970;
        color:white;
        padding:20px;
        border-radius:10px;
        text-align:center;
        margin-top:20px;
    }

    .attendance-box button {
        padding:12px 20px;
        background:#00cc66;
        border:none;
        color:white;
        border-radius:6px;
        font-size:16px;
        cursor:pointer;
        margin-top:10px;
    }

    .attendance-box button:hover {
        background:#00a855;
    }

    .logout-btn {
        background:#d9534f !important;
        margin-top:20px;
    }
</style>
</head>
<body>

<!-- SIDEBAR -->
<div class="sidebar">
    <h2 id="teacherName">Teacher</h2>

    <a href="#" onclick="showSection('overview')">Dashboard Overview</a>
    <a href="#" onclick="showSection('classes')">My Classes</a>
    <a href="#" onclick="showSection('profile')">My Profile</a>

    <!-- CLOCK-IN SIDEBAR PANEL -->
    <div class="attendance-box">
        <h3>Attendance</h3>
        <p id="clockStatus">Not clocked in</p>
        <button id="clockBtn" onclick="toggleClock()">Clock In</button>
    </div>

    <button class="logout-btn" onclick="logout()">Logout</button>
</div>

<!-- MAIN CONTENT -->
<div class="main">

    <!-- Overview -->
    <div id="overview" class="card">
        <h2>Welcome back, <span id="nameTitle"></span> ðŸ‘‹</h2>
        <p>This is your Teacher Dashboard.</p>
    </div>

    <!-- Classes -->
    <div id="classes" class="card" style="display:none;">
        <h2>Your Classes</h2>
        <p>Coming soon â€” subjects, timetables, assessments.</p>
    </div>

    <!-- Profile -->
    <div id="profile" class="card" style="display:none;">
        <h2>My Profile</h2>
        <p><b>Name:</b> <span id="p_name"></span></p>
        <p><b>Email:</b> <span id="p_email"></span></p>
        <p><b>Organization:</b> <span id="p_org"></span></p>
    </div>

</div>

<script>
// CONSTANT STORAGE KEYS
const TEACHERS_KEY = "teachers";
const ACTIVE_TEACHER_KEY = "active_teacher";
const ATTENDANCE_KEY = "teacher_attendance";

/* LOAD SESSION */
const activeTeacher = JSON.parse(localStorage.getItem(ACTIVE_TEACHER_KEY) || "null");

if (!activeTeacher) {
    alert("Session expired, login again.");
    window.location.href = "teacher-login.html";
}

/* Populate UI */
document.getElementById("teacherName").textContent = activeTeacher.name;
document.getElementById("nameTitle").textContent = activeTeacher.name;
document.getElementById("p_name").textContent = activeTeacher.name;
document.getElementById("p_email").textContent = activeTeacher.email;
document.getElementById("p_org").textContent = activeTeacher.org;

/* SECTION SWITCHER */
function showSection(id) {
    document.querySelectorAll(".card").forEach(c => c.style.display = "none");
    document.getElementById(id).style.display = "block";
}

/* READ / WRITE Attendance Data */
function getAttendance() {
    return JSON.parse(localStorage.getItem(ATTENDANCE_KEY) || "[]");
}

function saveAttendance(list) {
    localStorage.setItem(ATTENDANCE_KEY, JSON.stringify(list));
}

/* LOAD CLOCK STATUS */
let attendanceData = getAttendance();

// Find this teacher's record
let record = attendanceData.find(r => r.email === activeTeacher.email);

/* Create if not exist */
if (!record) {
    record = { email: activeTeacher.email, log: [] };
    attendanceData.push(record);
    saveAttendance(attendanceData);
}

/* UPDATE UI STATUS */
function updateClockUI() {
    const last = record.log[record.log.length - 1];

    if (!last || last.out) {
        document.getElementById("clockStatus").textContent = "Not clocked in";
        document.getElementById("clockBtn").textContent = "Clock In";
    } else {
        document.getElementById("clockStatus").textContent = "Clocked in at " + last.in;
        document.getElementById("clockBtn").textContent = "Clock Out";
    }
}

updateClockUI();

/* CLOCK BUTTON FUNCTION */
function toggleClock() {
    const now = new Date().toLocaleString();
    const last = record.log[record.log.length - 1];

    if (!last || last.out) {
        // CLOCK IN
        record.log.push({ in: now, out: null });
    } else {
        // CLOCK OUT
        last.out = now;
    }

    saveAttendance(attendanceData);
    updateClockUI();
    alert("Attendance updated!");
}

/* LOGOUT */
function logout() {
    localStorage.removeItem(ACTIVE_TEACHER_KEY);
    window.location.href = "teacher-login.html";
}

</script>

</body>
</html>
