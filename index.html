<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flawless Graphics â€“ HR Portal Login</title>

<style>
    body {
        margin:0;
        font-family: Arial, sans-serif;
        background:#f4f7fa;
        display:flex;
        justify-content:center;
        align-items:center;
        height:100vh;
    }
    .box {
        width:350px;
        padding:25px;
        background:white;
        border-radius:10px;
        box-shadow:0 8px 25px rgba(0,0,0,0.1);
    }
    h2 { text-align:center; margin-bottom:15px; color:#0b63a3; }
    input, select {
        width:100%; padding:10px;
        margin-top:8px; border:1px solid #dbe3ea;
        border-radius:6px;
    }
    button {
        width:100%; margin-top:12px; padding:10px;
        background:#0b63a3; border:0; color:#fff;
        border-radius:6px; cursor:pointer;
    }
    .link { text-align:center; margin-top:12px; cursor:pointer; color:#0b63a3; }
</style>
</head>
<body>

<div class="box" id="loginBox">
    <h2>Login</h2>
    <input id="loginEmail" type="email" placeholder="Email">
    <input id="loginPassword" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <div class="link" onclick="showRegister()">Create Account</div>
    <div class="link" onclick="forgotPass()">Forgot Password?</div>
</div>

<div class="box" id="registerBox" style="display:none">
    <h2>Create Organization</h2>

    <input id="regOrg" placeholder="Organization Name">
    <input id="regName" placeholder="Full Name">
    <input id="regEmail" type="email" placeholder="Email">
    <input id="regPassword" type="password" placeholder="Password">

    <button onclick="register()">Register</button>
    <div class="link" onclick="showLogin()">Already have an account?</div>
</div>

<script>
function showRegister(){
    loginBox.style.display="none";
    registerBox.style.display="block";
}
function showLogin(){
    loginBox.style.display="block";
    registerBox.style.display="none";
}

// SHA-256 hashing
async function sha256(msg){
    const buf = new TextEncoder().encode(msg);
    const hash = await crypto.subtle.digest("SHA-256", buf);
    return Array.from(new Uint8Array(hash)).map(b=>b.toString(16).padStart(2,"0")).join("");
}

// Registration
async function register(){
    let org = regOrg.value.trim();
    let name = regName.value.trim();
    let email = regEmail.value.trim().toLowerCase();
    let pass = regPassword.value.trim();

    if(!org || !name || !email || !pass){
        alert("All fields required");
        return;
    }

    let ORGS = JSON.parse(localStorage.getItem("Organizations") || "[]");

    if(ORGS.find(x => x.email === email)){
        alert("Email already exists!");
        return;
    }

    let hashed = await sha256(pass);

    ORGS.push({
        org,
        name,
        email,
        pass: hashed,
        createdAt: Date.now()
    });

    localStorage.setItem("Organizations", JSON.stringify(ORGS));

    alert("Account created! You can now login.");
    showLogin();
}

// Login
async function login(){
    let email = loginEmail.value.trim().toLowerCase();
    let pass = loginPassword.value.trim();

    let ORGS = JSON.parse(localStorage.getItem("Organizations") || "[]");
    let user = ORGS.find(x => x.email === email);

    if(!user){ alert("User not found."); return; }

    let hashed = await sha256(pass);

    if(hashed !== user.pass){
        alert("Incorrect password");
        return;
    }

    // Set active organization + HR
    localStorage.setItem("active_org", user.org.replace(/\s+/g,''));
    localStorage.setItem("activeHR", JSON.stringify({ name: user.name, role: "Admin" }));

    window.location.href = "hr-dashboard.html";
}

// Forgot password
async function forgotPass(){
    let email = prompt("Enter your email:");
    if(!email) return;

    let ORGS = JSON.parse(localStorage.getItem("Organizations") || "[]");
    let user = ORGS.find(x => x.email === email.toLowerCase());

    if(!user){ alert("Email not found"); return; }

    let code = Math.floor(100000 + Math.random()*900000);
    alert("Your reset code: " + code);

    let enter = prompt("Enter the reset code:");
    if(enter != code) return alert("Incorrect code");

    let newPass = prompt("Enter new password:");
    if(!newPass || newPass.length < 5) return alert("Invalid password");

    user.pass = await sha256(newPass);
    localStorage.setItem("Organizations", JSON.stringify(ORGS));

    alert("Password reset successful");
}
</script>

</body>
</html>
