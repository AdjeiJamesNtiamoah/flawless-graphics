<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Finance Dashboard | Flawless Graphics</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

<style>
/* -------------------- COLORS -------------------- */
:root {
  --primary:#007bff;
  --primary-light:#3ba1ff;
  --accent:#00d98f;
  --danger:#ff4b4b;
  --warning:#ffb400;
  --bg:#f5f7fa;
  --sidebar-bg:#0e1a35;
  --text-dark:#1f2937;
  --card-bg:#ffffff;
  --radius:14px;
}

/* Dark mode */
.dark {
  --bg:#0d1117;
  --card-bg:#161b22;
  --sidebar-bg:#0b0f14;
  --text-dark:#e5e7eb;
  --primary:#3b82f6;
}

/* -------------------- BASE -------------------- */
body {
  margin:0;
  background:var(--bg);
  font-family:Poppins, Arial;
  color:var(--text-dark);
  display:flex;
  height:100vh;
  overflow:hidden;
}

/* -------------------- SIDEBAR -------------------- */
.sidebar {
  width:260px;
  background:var(--sidebar-bg);
  color:white;
  display:flex;
  flex-direction:column;
  padding:20px;
  box-shadow:4px 0 20px rgba(0,0,0,.25);
}

.sidebar h2 {
  text-align:center;
  margin:0 0 20px;
  font-size:22px;
  font-weight:700;
}

.nav-item {
  padding:14px 16px;
  margin-bottom:5px;
  cursor:pointer;
  display:flex;
  gap:12px;
  align-items:center;
  border-radius:10px;
  color:#d0d7e3;
  transition:.2s;
}
.nav-item:hover, .nav-item.active {
  background:#1b2a4a;
  color:white;
}

.nav-item i { width:22px; }

/* -------------------- CONTENT -------------------- */
.content {
  flex:1;
  overflow:auto;
  padding:25px;
}

/* Header */
.header {
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:25px;
}

.header .title {
  font-size:26px;
  font-weight:700;
}

.header-buttons {
  display:flex;
  gap:10px;
}

.btn {
  padding:10px 14px;
  border:none;
  border-radius:10px;
  cursor:pointer;
  font-weight:600;
  transition:.2s;
}

.btn.primary { background:var(--primary); color:white; }
.btn.light { background:#e5e7eb; }
.btn.danger { background:var(--danger); color:white; }

/* KPI Cards */
.grid { display:grid; gap:18px; }

.kpi {
  background:var(--card-bg);
  padding:22px;
  border-radius:var(--radius);
  display:flex;
  align-items:center;
  gap:18px;
  box-shadow:0 4px 14px rgba(0,0,0,.08);
}

.kpi i {
  font-size:28px;
  padding:16px;
  background:rgba(59,130,246,0.18);
  border-radius:50%;
  color:var(--primary);
}

.kpi .value {
  font-size:26px;
  font-weight:700;
}

.kpi .label {
  color:gray;
  font-size:14px;
}

/* Section card */
.card {
  background:var(--card-bg);
  padding:22px;
  border-radius:var(--radius);
  margin-bottom:22px;
  box-shadow:0 6px 18px rgba(0,0,0,.09);
}

.card-title {
  font-size:20px;
  margin-bottom:12px;
  font-weight:700;
}

/* Toast */
#toast {
  position:fixed;
  right:25px;
  bottom:25px;
  background:#1e293b;
  color:white;
  padding:14px 18px;
  border-radius:12px;
  opacity:0;
  transform:translateY(20px);
  transition:.3s;
}
#toast.show { opacity:1; transform:translateY(0); }

</style>
</head>

<body>

<!-- -------------------- SIDEBAR -------------------- -->
<div class="sidebar">

  <h2>FINANCE PANEL</h2>

  <div class="nav-item active" data-page="overview">
    <i class="fa fa-chart-line"></i> Overview
  </div>

  <div class="nav-item" data-page="transactions">
    <i class="fa fa-wallet"></i> Income & Expenses
  </div>

  <div class="nav-item" data-page="fees">
    <i class="fa fa-coins"></i> Fee Collection
  </div>

  <div class="nav-item" data-page="payroll">
    <i class="fa fa-money-bill-wave"></i> Payroll
  </div>

  <div class="nav-item" data-page="budget">
    <i class="fa fa-chart-pie"></i> Budget Planner
  </div>

  <div class="nav-item" data-page="audit">
    <i class="fa fa-clipboard-list"></i> Audit Logs
  </div>

  <div class="nav-item" data-page="settings">
    <i class="fa fa-cog"></i> Settings
  </div>

</div>

<!-- -------------------- CONTENT AREA -------------------- -->
<div class="content">

  <div class="header">
    <div class="title">Finance Dashboard — <span id="orgName">FLAWLESS</span></div>

    <div class="header-buttons">
      <button class="btn light" id="themeToggle"><i class="fa fa-moon"></i></button>
      <button class="btn primary" id="exportPDF">Export PDF</button>
    </div>
  </div>

  <!-- -------- KPI CARDS -------- -->
  <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); margin-bottom:20px;">

    <div class="kpi">
      <i class="fa fa-arrow-trend-up"></i>
      <div>
        <div class="value" id="totalIncome">₵0</div>
        <div class="label">Total Income</div>
      </div>
    </div>

    <div class="kpi">
      <i class="fa fa-arrow-trend-down"></i>
      <div>
        <div class="value" id="totalExpenses">₵0</div>
        <div class="label">Total Expenses</div>
      </div>
    </div>

    <div class="kpi">
      <i class="fa fa-wallet"></i>
      <div>
        <div class="value" id="netBalance">₵0</div>
        <div class="label">Net Balance</div>
      </div>
    </div>

    <div class="kpi">
      <i class="fa fa-coins"></i>
      <div>
        <div class="value" id="feesCollected">₵0</div>
        <div class="label">Fees Collected</div>
      </div>
    </div>

  </div>

  <!-- -------- CHARTS AREA -------- -->
  <div class="card">
    <div class="card-title">Finance Overview Chart</div>
    <canvas id="overviewChart" height="130"></canvas>
  </div>

  <!-- Placeholder (more parts coming) -->
  <div id="sectionContainer"></div>

</div>

<!-- Toast -->
<div id="toast"></div>

<script>
/* ----------------- BASIC DATA HANDLING ----------------- */
function safeParse(x){ try{return JSON.parse(x);}catch{return null;} }
function read(k){ return safeParse(localStorage.getItem(k)) || []; }
function save(k,v){ localStorage.setItem(k, JSON.stringify(v)); }
function toast(msg){
  const t=document.getElementById("toast");
  t.textContent=msg;
  t.classList.add("show");
  setTimeout(()=>t.classList.remove("show"),2500);
}

/* ----------------- KEYS ----------------- */
const ORG = localStorage.getItem("active_org") || "FLAWLESS";
document.getElementById("orgName").textContent = ORG;

const TX_KEY = `${ORG}_finance_transactions`;
const FEE_KEY = `${ORG}_finance_fees`;
const PAY_KEY = `${ORG}_finance_payroll`;
const AUDIT_KEY = `${ORG}_finance_audit`;

/* Create storage if missing */
[TX_KEY,FEE_KEY,PAY_KEY,AUDIT_KEY].forEach(k=>{
  if(!localStorage.getItem(k)) save(k,[]);
});

/* ----------------- KPIs UPDATE ----------------- */
function updateKPIs(){
  const tx = read(TX_KEY);

  const income = tx.filter(t=>t.type==="income")
                   .reduce((a,b)=>a+Number(b.amount),0);

  const expenses = tx.filter(t=>t.type==="expense")
                     .reduce((a,b)=>a+Number(b.amount),0);

  const fees = read(FEE_KEY).reduce((a,b)=>a+b.amount,0);

  document.getElementById("totalIncome").textContent = "₵"+income.toLocaleString();
  document.getElementById("totalExpenses").textContent = "₵"+expenses.toLocaleString();
  document.getElementById("netBalance").textContent = "₵"+(income-expenses).toLocaleString();
  document.getElementById("feesCollected").textContent = "₵"+fees.toLocaleString();
}

/* Initial load */
updateKPIs();

</script>
</body>
</html>
