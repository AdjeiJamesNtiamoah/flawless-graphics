<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Finance Dashboard | Flawless Graphics</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<style>
body {
    margin: 0;
    background: #f4f7fb;
    font-family: Poppins, Arial;
    display: flex;
}

/* Sidebar */
.sidebar {
    width: 250px;
    background: #0c1427;
    color: white;
    height: 100vh;
    padding-top: 20px;
}

.sidebar h2 {
    text-align: center;
    margin-bottom: 25px;
}

.nav-item {
    padding: 14px 20px;
    cursor: pointer;
    color: #cbd5e1;
}
.nav-item:hover {
    background: #162544;
    color: white;
}

/* Main */
.main {
    flex: 1;
    padding: 25px;
}

/* Cards */
.card {
    background: white;
    border-radius: 12px;
    padding: 20px;
    margin-bottom: 25px;
    box-shadow: 0 4px 14px rgba(0,0,0,0.08);
}

.card-title {
    font-size: 22px;
    font-weight: bold;
    margin-bottom: 10px;
}

table {
    width: 100%;
    border-collapse: collapse;
}
th, td {
    padding: 10px;
    border-bottom: 1px solid #e5e7eb;
}

.btn {
    padding: 8px 14px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 600;
}
.btn.approve { background:#10b981; color:white; }
.btn.reject { background:#ef4444; color:white; }
.btn.approve:hover{ opacity:.85; }
.btn.reject:hover{ opacity:.85; }

.status-pending { color: #d97706; font-weight: bold; }
.status-paid { color: #10b981; font-weight: bold; }
.status-rejected { color: #ef4444; font-weight: bold; }
</style>
</head>

<body>

<!-- SIDEBAR -->
<div class="sidebar">
    <h2>FINANCE</h2>
    <div class="nav-item">Dashboard</div>
    <div class="nav-item">Pending Payments</div>
    <div class="nav-item">Payment History</div>
</div>

<!-- MAIN -->
<div class="main">

    <h1>Finance Dashboard — <span id="orgDisplay"></span></h1>

    <!-- Pending Requests -->
    <div class="card">
        <div class="card-title">Pending Payroll Requests</div>
        <table>
            <thead>
                <tr>
                    <th>Request ID</th>
                    <th>Submitted</th>
                    <th>Status</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody id="pendingTable"></tbody>
        </table>
    </div>

    <!-- Payment History -->
    <div class="card">
        <div class="card-title">Payment History</div>
        <table>
            <thead>
                <tr>
                    <th>Request ID</th>
                    <th>Paid At</th>
                    <th>Total Amount</th>
                </tr>
            </thead>
            <tbody id="historyTable"></tbody>
        </table>
    </div>

</div>

<script>
/* ---------- ORG CONFIG ---------- */
const ACTIVE_ORG = localStorage.getItem("active_org") || "FLAWLESS";
document.getElementById("orgDisplay").textContent = ACTIVE_ORG;

const REQ_KEY = `${ACTIVE_ORG}_finance_requests`;
const PAY_KEY = `${ACTIVE_ORG}_finance_payments`;

function read(key){
    return JSON.parse(localStorage.getItem(key) || "[]");
}
function save(key,val){
    localStorage.setItem(key, JSON.stringify(val));
}

/* ---------- RENDER PENDING ---------- */
function renderPending(){
    const list = read(REQ_KEY);
    const tb = document.getElementById("pendingTable");
    tb.innerHTML = "";

    list.filter(r=>r.status==="pending").forEach(r=>{
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${r.id}</td>
            <td>${new Date(r.submittedAt).toLocaleString()}</td>
            <td class="status-pending">PENDING</td>
            <td>
                <button class="btn approve" onclick="approve('${r.id}')">Approve</button>
                <button class="btn reject" onclick="reject('${r.id}')">Reject</button>
            </td>
        `;
        tb.appendChild(tr);
    });
}

/* ---------- RENDER HISTORY ---------- */
function renderHistory(){
    const history = read(PAY_KEY);
    const tb = document.getElementById("historyTable");
    tb.innerHTML = "";

    history.forEach(h=>{
        const total = h.data.reduce((s,e)=> s + Number(e.salary||0), 0);

        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${h.id}</td>
            <td>${new Date(h.paidAt).toLocaleString()}</td>
            <td>₵${total.toLocaleString()}</td>
        `;
        tb.appendChild(tr);
    });
}

/* ---------- APPROVE ---------- */
function approve(id){
    const list = read(REQ_KEY);
    const item = list.find(r=>r.id===id);
    if(!item) return;

    item.status = "paid";
    item.paidAt = new Date().toISOString();

    save(REQ_KEY, list);

    const history = read(PAY_KEY);
    history.push(item);
    save(PAY_KEY, history);

    alert("Payroll approved and marked as PAID.");
    renderPending();
    renderHistory();
}

/* ---------- REJECT ---------- */
function reject(id){
    const list = read(REQ_KEY);
    const item = list.find(r=>r.id===id);
    if(!item) return;

    item.status = "rejected";
    save(REQ_KEY, list);

    alert("Request marked as REJECTED.");
    renderPending();
}

/* ---------- INITIAL RENDER ---------- */
renderPending();
renderHistory();
</script>
</body>
</html>
